<?php

    /**
     * Part of PHP-Ghetto-IPC, a library to execute PHP code between different
     * PHP versions, usually from PHP 4 (called frontend) to 5 (called backend).
     *
     * StdIODriver is the class responsible for writing to STDOUT and reading
     * from STDIO the data generated by GhettoIPC. Not implemented for now.
     *
     * @author Mendel Gusmao <mendelsongusmao () gmail.com>
     * @copyright Mendel Gusmao
     * @version 1.4
     *
     */
    class StdIODriver {
        
        var $name = "Driver";
        
        var $id;
        var $handle;
        var $runner;
        var $data;
        var $valid;
        var $serializer;

        function __construct ($serializer = null) {
            
            $this->StdIODriver($serializer);

        }
        
        function StdIODriver ($serializer = null) {
            
            if (is_null($serializer))
                $serializer = new DefaultSerializer;
            
            $this->serializer = $serializer;            
            
        } 
        
        function initialize ($id) {

            $this->id = $id;
            $this->valid = false;

            if ($this->stdin_descriptor = fopen($this->stdin_file, "r") &&
                $this->stdout_descriptor = fopen($this->stdout_file, "w"))
                $this->valid = true;	
                
            return $this->valid;
        }

        function set ($data) {

            $data = $this->serializer->serialize($data);
            fwrite($this->stdout_descriptor, $data);
			
        }

        function get () {

            $data = "";

            while ($temp = fread($this->stdin_descriptor, 1024))
                $data .= $temp;

            return $this->serializer->unserialize($data);
        }

        function delete () {

            return true;
            
        }

        function valid () {

            return $this->valid & is_array(@fstat($this->descriptor));
            
        }

    }

?>